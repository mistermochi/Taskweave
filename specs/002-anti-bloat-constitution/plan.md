# Implementation Plan: Anti-Bloat Constitution Amendments

**Branch**: `002-anti-bloat-constitution` | **Date**: 2026-02-22 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/002-anti-bloat-constitution/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/plan-template.md` for the execution workflow.

## Summary

This feature documents architectural anti-patterns discovered in the codebase and proposes constitutional amendments to prevent future bloat. The approach is governance-focused: updating the constitution document with new rules, limits, and automated enforcement mechanisms. Since this is a client-only Firebase application, all amendments respect the client-side constraint.

## Technical Context

**Language/Version**: TypeScript 5.3+  
**Primary Dependencies**: Next.js 14, Firebase (Firestore & Auth), Jest 29.x  
**Storage**: Firebase Firestore with IndexedDB persistence (existing)  
**Testing**: Jest with @testing-library/react (existing)  
**Target Platform**: Web (PWA)  
**Project Type**: Client-only web application with offline support  
**Performance Goals**: Maintain existing performance budgets (LCP <2.5s, TTI <3.5s)  
**Constraints**: Client-side only architecture - no Server Actions  
**Scale/Scope**: Single codebase, ~42 components, ~14 services

## Constitution Check

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Exclusive Focus | ✅ Compatible | No impact on task logic |
| II. Atomic Operations | ✅ Compatible | No changes to data mutations |
| III. Real-time First | ✅ Compatible | Maintains onSnapshot patterns |
| IV. Semantic Clarity | ✅ Compatible | No terminology changes |
| V. Offline Reliability | ✅ Compatible | Maintains offline-first approach |
| VI. Test-Driven Development | ✅ Compatible | TDD principles remain |
| VII. Client-Side Only | ✅ Compatible | All amendments respect client-only |

**GATE PASSED**: All proposed amendments are compatible with existing constitution.

## Project Structure

### Documentation (this feature)

```
specs/002-anti-bloat-constitution/
├── plan.md              # This file
├── research.md          # Phase 0 - Not needed (governance doc)
├── data-model.md        # Phase 1 - Not applicable (no data model)
├── quickstart.md        # Phase 1 - Constitution update guide
├── contracts/           # Phase 1 - Not applicable (no external interfaces)
└── tasks.md            # Phase 2 - Generated by /speckit.tasks
```

### Source Code (repository root)

No source code changes. This feature updates governance documents only:

```
.specify/memory/
└── constitution.md      # Amended with new anti-bloat rules
```

**Structure Decision**: This is a governance/documentation feature. No source code changes. The "implementation" is updating `.specify/memory/constitution.md` with the proposed amendments.

---

## Phase 0: Research

**Not required**. The anti-patterns were discovered through codebase analysis. All clarifications were resolved during `/speckit.clarify`:
- Client-only architecture constraint confirmed
- Firebase credentials handling clarified (safe for client-only)
- Server Actions removed from scope

---

## Phase 1: Design

### Quickstart: Applying Constitution Amendments

The amendments in Appendix B of the spec should be integrated into `.specify/memory/constitution.md`:

1. **VII. Client-Side Architecture Conventions** - Already added (v1.2.0)
2. **VIII. Component Size Limits** - Add as new principle
3. **IX. Type Safety Enforcement** - Add as new principle  
4. **X. Code Duplication Tolerance** - Add as new principle
5. **XI. Performance Budgets** - Add as new principle
6. **XII. Context Provider Consolidation** - Add as new principle
7. **XIII. Automated Code Health Gates** - Add as new principle

### Data Model

**Not applicable** - This is a governance document, not a software feature. No data model required.

### Contracts

**Not applicable** - No external interfaces. This is an internal governance update.

---

## Recommended Implementation Order

1. **Immediate**: Add size limits and type safety rules to constitution
2. **Short-term**: Establish code health gates in CI
3. **Ongoing**: Refactor large components per remediation priorities

---

## Notes

- This feature is primarily documentation/governance
- The "implementation" is updating the constitution file
- No new tests required (governance changes)
- No new dependencies needed (uses existing ESLint tooling)
